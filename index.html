<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Our Night On The Terrace</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div class="scene">
    <video class="bg-video" src="sky-2.mp4" autoplay muted loop playsinline></video>
    
    
    <div class="moon" id="moon"></div>

    <!-- main couple image (must be present) -->
    <img src="main-pair.png" class="couple" alt="Couple on terrace" />

    <div class="dialogue" aria-hidden="true">
      <div id="lineContainer"></div>
    </div>

    <div class="reply-area" id="replyArea" aria-hidden="true">
      <div class="reply-label" id="replyLabel">Type reply to continue</div>
      <div class="reply-row">
        <input id="replyInput" type="text" autocomplete="off" placeholder="ok, haa, yaa..." />
        <button id="replyBtn">Send</button>
      </div>
      <div class="reply-hint">Use short replies like: ok, haa, yaa, hoo, hmm</div>
    </div>

    <div class="hint" id="hint"></div>
    <button class="replay-btn" id="replayBtn" aria-hidden="true">Replay</button>
    <div class="tap-area" id="tapArea"></div>
  </div>

  <script>
    // conversation script (short sample; you can edit)
    const script = [
      {
    speaker: "Me",
    type: "me",
    text: "hmmmmmmm ",
    needsReplyFrom: null
  },
  {
    speaker: "Kavya",
    type: "her",
    text: "hmmmm ",
    needsReplyFrom: null
  },
  {
    speaker: "Me",
    type: "me",
    text: "sooo....",
    needsReplyFrom: null
  },
  {
    speaker: "Kavya",
    type: "her",
    text: "Why did you came?",
    needsReplyFrom: null
  },
  {
    speaker: "Me",
    type: "me",
    text: "to meet my sister...",
    needsReplyFrom: null
  },
  {
    speaker: "Kavya",
    type: "her",
    text: "good....then go and spend time with her....",
    needsReplyFrom: null
  },
  {
    speaker: "Me",
    type: "me",
    text: "Why are you staring at me like that?",
    needsReplyFrom: null
  },
  {
    speaker: "Kavya",
    type: "her",
    text: "Because you don’t have the courage to look at me. You’re pretending to admire the sky, but I know you’re just avoiding eye contact.",
    needsReplyFrom: null
  },
  {
    speaker: "Me",
    type: "me",
    text: "And what’s your problem if I look at the sky?",
    needsReplyFrom: null
  },
  {
    speaker: "Kavya",
    type: "her",
    text: "The sky has nothing tonight. No moon, no stars. So you’re left with only one option — me.",
    needsReplyFrom: null
  },
  {
    speaker: "Me",
    type: "me",
    text: "That’s true… the night is completely empty. No stars, no moon… just this terrace, the silence..... and us.",
    needsReplyFrom: null
  },
  {
    speaker: "Kavya",
    type: "her",
    text: "And somehow, I still like it. This place feels like ours… midnight terrace.",
    needsReplyFrom: null
  },
  {
    speaker: "Me",
    type: "me",
    text: "Whenever I imagine peace… this is exactly how it looks. Here. At night. With you.",
    needsReplyFrom: null
  },
  {
    speaker: "Kavya",
    type: "her",
    text: "You talk like you’re peaceful, but you carry a whole storm inside you. Still… your face looks calm.",
    needsReplyFrom: null
  },
  {
    speaker: "Me",
    type: "me",
    text: "Whenever I look at you… the storm slows down. Maybe even stops.",
    needsReplyFrom: null
  },
  {
    speaker: "Kavya",
    type: "her",
    text: "Do you remember the day I told you I had feelings for you?",
    needsReplyFrom: null
  },
  {
    speaker: "ME",
    type: "me",
    text: "How could I forget? You didn’t even say “I love you,” but somehow it felt heavier than those three words.",
    needsReplyFrom: null
  },
  {
    speaker: "Kavya",
    type: "her",
    text: "I couldn’t say that word. I just said… “I’m having feelings for you.”",
    needsReplyFrom: null
  },
  {
    speaker: "Me",
    type: "me",
    text: "And I told you, “Take time, think about it, and come back to me.”",
    needsReplyFrom: null
  },
  {
    speaker: "Kavya",
    type: "her",
    text: "And the next day I came straight to you. No hesitation.No doubt. I knew exactly what I wanted.",
    needsReplyFrom: null
  },
  {
    speaker: "Me",
    type: "me",
    text: "That day… for the first time in my life, someone chose me even after knowing everything. My past. My mistakes. My stories.",
    needsReplyFrom: null
  },
  {
    speaker: "Me",
    type: "me",
    text: "You saw the man behind the noise, and for the first time, I wanted to be seen.",
    needsReplyFrom: null
  },
  {
    speaker: "Me",
    type: "me",
    text: "That shocked me. The things that people used to judge me for… the things I was ashamed to tell anyone… yet you stayed.",
    needsReplyFrom: null
  },
  {
    speaker: "Me",
    type: "me",
    text: "I was that guy… dated so many women, confused, immature, always running. but at you I don't know, I stopped",
    needsReplyFrom: null
  },
  {
    speaker: "Kavya",
    type: "her",
    text: "Ik Ik",
    needsReplyFrom: null
  },
  {
    speaker: "Kavya",
    type: "her",
    text: "Soooooo",
    needsReplyFrom: null
  },
  {
    speaker: "Kavya",
    type: "her",
    text: "what else......??",
    needsReplyFrom: null
  },
  {
    speaker: "Me",
    type: "me",
    text: "Listen.....",
    needsReplyFrom: null
  },
  {
    speaker: "Me",
    type: "me",
    text: "I like you kavya....very much but it's not like I'm in love with you. but",
    needsReplyFrom: null
  },
  {
    speaker: "Me",
    type: "me",
    text: "I want you....and I need you in my life......",
    needsReplyFrom: null
  },
  {
    speaker: "Me",
    type: "me",
    text: "I don't know what's this relation is and I don't want to name it. but I need it",
    needsReplyFrom: null
  },
  {
    speaker: "Me",
    type: "me",
    text: "yaaahhhhh.....and....",
    needsReplyFrom: null
  },
  {
    speaker: "Kavya",
    type: "her",
    text: "I'm falling for you teja",
    needsReplyFrom: null
  },
  {
    speaker: "Kavya",
    type: "her",
    text: "I need you in my life — not for a moment, but for a lifetime.",
    needsReplyFrom: null
  },

  {
    speaker: "Me",
    type: "me",
    text: "Somewhere between yesterday’s silence and today’s breath, my heart whispered your name…",
    needsReplyFrom: null
  },
  {
    speaker: "Me",
    type: "me",
    text: "and I realised, I want you. I need you, like the night needs the moon to feel complete.",
    needsReplyFrom: null
  },
  {
    speaker: "Kavya",
    type: "her",
    text: "You’re the one I will choose, again and again.....",
    needsReplyFrom: null
  },
  {
    speaker: "Me",
    type: "me",
    text: "I'm going to make a promise to you, Kavya… it's definitely not a commitment.",
    needsReplyFrom: null
  },
  {
    speaker: "Me",
    type: "me",
    text: "No matter what, I will always stay with you… especially when you need me the most. You will always have a shoulder to rely on.",
    needsReplyFrom: null
  },{
    speaker: "Me",
    type: "me",
    text: "Whenever your eyes fill with tears, whenever your heart trembles… I’ll be there. Without hesitation. Without distance. Without fear.",
    needsReplyFrom: null
  },
  {
    speaker: "Me",
    type: "me",
    text: "Ne kallu taddichina… ne khallu tadabaddina… nē kosam nēnu vastā.",
    needsReplyFrom: null
  },
  {
    speaker: "Kavya",
    type: "her",
    text: "I believed you… and I'll do.",
    needsReplyFrom: null
  },
  {
    speaker: "Kavya",
    type: "her",
    text: "And I'll stay with you and I'll never leave you for another man",
    needsReplyFrom: null
  },
  {
    speaker: "Me",
    type: "me",
    text: "okkkkkk ",
    needsReplyFrom: null
  },
  {
    speaker: "Me",
    type: "me",
    text: "Hmmmmm ",
    needsReplyFrom: null
  },
  {
    speaker: "Kavya",
    type: "her",
    text: "Hmmmmm",
    needsReplyFrom: null
  },
  {
    speaker: "Kavya",
    type: "her",
    text: "I love you ani neku assalu cheppanu",
    needsReplyFrom: null
  },
  {
    speaker: "Me",
    type: "me",
    text: "Nenu kuda neku I love you ani assalu cheppanu ",
    needsReplyFrom: null
  },
  {
    speaker: "Me",
    type: "me",
    text: "you know people say if you wish for something and if it's valid god will grant it ",
    needsReplyFrom: null
  },
  {
    speaker: "Kavya",
    type: "her",
    text: "Really.....",
    needsReplyFrom: null
  },
  {
    speaker: "Kavya",
    type: "her",
    text: "then wish there was a full moon. Not some crazy sky, just a normal one with a few simple stars.",
    needsReplyFrom: null
  },
  { 
    speaker: "Narration", 
    type: "narrator", 
    text: "And this… is just the beginning of our story.", 
    needsReplyFrom: null }
    ];

    const lineContainer = document.getElementById('lineContainer');
    const tapArea = document.getElementById('tapArea');
    const hint = document.getElementById('hint');

    const nightOverlay = document.getElementById('nightOverlay');
    const moon = document.getElementById('moon');
    const starsContainer = document.getElementById('stars');

    const replyArea = document.getElementById('replyArea');
    const replyLabel = document.getElementById('replyLabel');
    const replyInput = document.getElementById('replyInput');
    const replyBtn = document.getElementById('replyBtn');
    const replayBtn = document.getElementById('replayBtn');

    let index = 0;
    let waitingForReply = false;
    const allowedReplies = ["ok","okay","haa","ha","ya","yaa","yes","hoo","yoo","hmm","hmmm"];

    const HEAD_RATIO = 0.36;
    function createBubble(item) {
      const div = document.createElement('div');
      div.className = 'line ' + item.type;
      if (item.type !== 'narrator') {
        const sp = document.createElement('span');
        sp.className = 'speaker';
        sp.textContent = item.speaker;
        div.appendChild(sp);
      }
      const textSpan = document.createElement('span');
      textSpan.className = 'text';
      textSpan.textContent = item.text;
      div.appendChild(textSpan);

      // Append to body so bubbles are positioned in viewport coords
      document.body.appendChild(div);
      return div;
    }

    function clearBubbles() {
      document.querySelectorAll('body > .line').forEach(el => el.remove());
    }

    function showLine(item) {
      clearBubbles();
      const bubble = createBubble(item);
      // animate
      void bubble.offsetWidth;
      bubble.classList.add('visible');

      // reposition after bubble exists
      requestAnimationFrame(() => {
        if (window.positionBubbles) window.positionBubbles();
      });
      return bubble;
    }

    function showReplyPrompt(role) {
      waitingForReply = true;
      replyArea.setAttribute('aria-hidden','false');
      replyArea.classList.add('show');
      replyLabel.textContent = role === 'her' ? 'Type her reply to continue' : 'Type your reply to continue';
      replyInput.value = '';
      replyInput.focus();
      tapArea.style.pointerEvents = 'none';
    }

    function hideReplyPrompt() {
      waitingForReply = false;
      replyArea.setAttribute('aria-hidden','true');
      replyArea.classList.remove('show');
      tapArea.style.pointerEvents = 'auto';
    }

    function checkReply() {
      const v = replyInput.value.trim().toLowerCase();
      if (allowedReplies.includes(v)) {
        hideReplyPrompt();
        nextLine();
      } else if (v.length) {
        replyInput.classList.add('shake');
        setTimeout(()=>replyInput.classList.remove('shake'),300);
      }
    }

    function nextLine() {
      if (waitingForReply) return;
      if (index >= script.length) return;
      const item = script[index];

      if (item.text.toLowerCase().includes('full moon')) {
        nightOverlay.classList.add('fade-out');
        moon.classList.add('visible');
      }

      showLine(item);
      index++;
      hint.classList.add('hidden');

      if (item.needsReplyFrom) {
        setTimeout(()=>showReplyPrompt(item.needsReplyFrom), 450);
      } else if (index === script.length) {
        replayBtn.classList.add('show');
        replayBtn.setAttribute('aria-hidden','false');
      }
    }

    let hasStarted = false;
    tapArea.addEventListener('click', () => {
      if(!hasStarted){
        hasStarted = true;
        nextLine();
        return;
      }
      if(!waitingForReply) nextLine();
    });
    replyBtn.addEventListener('click', checkReply);
    replyInput.addEventListener('keydown', (e)=> { if (e.key === 'Enter') checkReply(); });

    replayBtn.addEventListener('click', ()=> {
      index = 0;
      waitingForReply = false;
      nightOverlay.classList.remove('fade-out');
      moon.classList.remove('visible');
      replyArea.classList.remove('show');
      replayBtn.classList.remove('show');
      clearBubbles();
      hint.classList.remove('hidden');
      tapArea.style.pointerEvents = 'auto';
      nextLine();
    });

    // background stars
    (function createStars(n=40){
      for (let i=0;i<n;i++){
        const s = document.createElement('span');
        s.className='star';
        s.style.top = (Math.random()*55)+'vh';
        s.style.left = (Math.random()*100)+'vw';
        s.style.setProperty('--delay', (Math.random()*4)+'s');
        starsContainer.appendChild(s);
      }
    })();
  </script>
  <script>
  (function(){
    // Tuned values (calculated from your actual main-couple.png)
    // HEAD_RATIO = fraction from image top where heads sit (~0.34 of image height)
    const HEAD_RATIO = 0.34;
    const GAP = 12;         // px gap between bubble and image edge
    const SAFE_PAD = 10;    // px padding from viewport edges
    // horizontal offsets relative to image center (tuned for your image)
    const HER_OFFSET = -0.12;
    const ME_OFFSET  = 0.18;

    const couple = document.querySelector('.couple');
    if (!couple) { console.warn('positionBubbles: .couple image not found'); return; }

    function placeAvoid(bubbleEl, centerX, imageRect) {
      if (!bubbleEl) return;
      // ensure measured as fixed
      bubbleEl.style.position = 'fixed';
      bubbleEl.style.transform = 'none';
      bubbleEl.style.zIndex = 1001;

      // measure natural size (put offscreen temporarily to avoid clipping)
      bubbleEl.style.left = '-9999px';
      bubbleEl.style.top = '-9999px';
      const bRect = bubbleEl.getBoundingClientRect();
      const bw = Math.max(80, Math.round(bRect.width));
      const bh = Math.max(24, Math.round(bRect.height));

      // compute image head top in viewport coords
      const headTop = imageRect.top + imageRect.height * HEAD_RATIO;

      // prefer above
      let topAbove = Math.round(headTop - bh - GAP);
      // if above would be too close to top, place below image
      let top;
      if (topAbove >= SAFE_PAD) {
        top = topAbove;
      } else {
        // place below image
        top = Math.round(imageRect.bottom + GAP);
        // if that pushes bubble off bottom, clamp so bubble stays visible (but won't overlap image)
        if (top + bh + SAFE_PAD > window.innerHeight) {
          top = Math.max(SAFE_PAD, window.innerHeight - bh - SAFE_PAD);
        }
      }

      // horizontal centered at centerX, clamped
      let left = Math.round(centerX - bw / 2);
      left = Math.max(SAFE_PAD, Math.min(window.innerWidth - bw - SAFE_PAD, left));

      bubbleEl.style.top = top + 'px';
      bubbleEl.style.left = left + 'px';
      bubbleEl.style.width = 'auto';
    }

    function positionNow() {
      const rect = couple.getBoundingClientRect();
      if (rect.width === 0 || rect.height === 0) return;

      const centerX = rect.left + rect.width/2;
      const herCenter = Math.round(centerX + rect.width * HER_OFFSET);
      const meCenter  = Math.round(centerX + rect.width * ME_OFFSET);

      const her = document.querySelector('.line.her');
      const me  = document.querySelector('.line.me');
      const narrator = document.querySelector('.line.narrator');

      if (her) placeAvoid(her, herCenter, rect);
      if (me)  placeAvoid(me, meCenter, rect);
      if (narrator) placeAvoid(narrator, centerX, rect);
    }

    // expose and wire events
    window.positionBubbles = function(){ requestAnimationFrame(positionNow); };
    window.addEventListener('resize', window.positionBubbles);
    window.addEventListener('orientationchange', window.positionBubbles);
    window.addEventListener('scroll', window.positionBubbles);
    if (couple.complete) window.positionBubbles();
    else couple.addEventListener('load', window.positionBubbles, { once:true });

    // retries for layout shifts
    setTimeout(window.positionBubbles, 250);
    setTimeout(window.positionBubbles, 900);
  })();
  </script>
</body>
</html>





